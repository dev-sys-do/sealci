
# Summary
The agent is the powerhouse of SealCi. It will receive jobs and try to run them in order to complete the operational part of the CI.

# The role of the agent
The goal of this component  is to provide execution environment for the scheduler and safe and correctly configured environments.

# Agent operations

## Registering to the scheduler
The agent is a slave of the scheduler and therefore he needs to be able to communicate with it. The agent will register to the scheduler at its startup. The scheduler will then be able to send jobs to the agent.

## Health link
At any moment in its life, the agent must be able to provide information about its health status. This information will be sent to the scheduler so that it can make decisions accordingly.

TODO: parler de la socket ouverte pour envoyer les infos de santé en continu

## Getting jobs
Jobs are the composition of configuration for the execution environnement and for the execution itself that will run in an encapsulated environment. The agent must have access to this environment in order to manage it.
The scheduler will send jobs to the agent for it to execute them taking into account the health status of the agent, 

TODO: changer pour dire que le scheduler ouvre une socket pour envoyer le info sur un job et qu'il y a donc une socket par job, et que si la socket est fermée le job est annulé.

## Creating encapsulated environment
The agent will try to create an encapsulated environment from a given configuration. This mechanism is mandatory, if it fail the entire job will fail. 
If it successful, the job will process the execution configuration and run it. 

The agent must have access to every logs of the job both from the creation of the environment and execution part. To be able to stream them to the scheduler.

## Running jobs

Once the environment has been created and configured and the job has been received, the agent must execute the job.

TODO: maybe mouve the part about the introduction of logs streaming from the creating env here

## Streaming informations and logs

At each stage of the job's progress, the agent must be able to stream information to the scheduler thanks to an open connection throughout the life of the agent.


<!-- An open connection will be maintained with the scheduler and the agent will be able to stream anything at anytime in the connection.

There will be two main streaming source:
- health logs
- jobs logs

Health logs will be streamed chronologically in order to gather the most precise state of the agent. Those logs will gather the usage of resource at one moment.

Jobs logs will be streamed every time that a job will provide one. -->

## Create and return artifacts
When a job is completed, the agent must be able to return the artifacts generated by the job. These artifacts will be stored in a dedicated location so that the scheduler can retrieve them.

## Cleaning up
After each job, the agent must be able to clean the environment created for the job, in order to start again on a healthy basis for the next job.

## Optional: Cache
An optional feature of the agent is to provide a cache system. This cache system will be used to store the most used images and environments in order to speed up the creation of the encapsulated environment.

<!-- # Communication with scheduler
The agent is a slave of the scheduler and therefore he needs to be able to communicate with it. 

### Requests
While the agent is up the scheduler must be able to schedule jobs at any moment. That's why the agent will expose a route to give configuration to create jobs.

### Logs streaming -->

